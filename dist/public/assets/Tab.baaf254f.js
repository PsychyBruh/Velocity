import{G as h,y as Z,i as j,t as W,f as P,o as ee,d as A,F as te,w as ne,x as re,H as ie,c as f,e as l,I as oe,J as N,K as se,D as O,C as d,L,B as E,M as ae}from"./index.596163ac.js";import{a as fe,g as ce,n as ue}from"./url.064866d1.js";import{B as le}from"./BareClient.06787bc0.js";class c{#t;#n;#e;constructor(e){if("separator"in e){this.#e=e.separator;return}this.#t=e.text,this.#n=e.onClick}get text(){return this.#t}get onClick(){return this.#n}get separator(){return this.#e}}var S={exports:{}},p=typeof Reflect=="object"?Reflect:null,$=p&&typeof p.apply=="function"?p.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},x;p&&typeof p.ownKeys=="function"?x=p.ownKeys:Object.getOwnPropertySymbols?x=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:x=function(e){return Object.getOwnPropertyNames(e)};function de(t){console&&console.warn&&console.warn(t)}var B=Number.isNaN||function(e){return e!==e};function a(){a.init.call(this)}S.exports=a;S.exports.once=we;a.EventEmitter=a;a.prototype._events=void 0;a.prototype._eventsCount=0;a.prototype._maxListeners=void 0;var I=10;function b(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return I},set:function(t){if(typeof t!="number"||t<0||B(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");I=t}});a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};a.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||B(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function F(t){return t._maxListeners===void 0?a.defaultMaxListeners:t._maxListeners}a.prototype.getMaxListeners=function(){return F(this)};a.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var u=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw u.context=o,u}var v=s[e];if(v===void 0)return!1;if(typeof v=="function")$(v,this,n);else for(var R=v.length,Q=H(v,R),r=0;r<R;++r)$(Q[r],this,n);return!0};function q(t,e,n,r){var i,s,o;if(b(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),o===void 0)o=s[e]=n,++t._eventsCount;else if(typeof o=="function"?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=F(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=o.length,de(u)}return t}a.prototype.addListener=function(e,n){return q(this,e,n,!1)};a.prototype.on=a.prototype.addListener;a.prototype.prependListener=function(e,n){return q(this,e,n,!0)};function he(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function K(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=he.bind(r);return i.listener=n,r.wrapFn=i,i}a.prototype.once=function(e,n){return b(n),this.on(e,K(this,e,n)),this};a.prototype.prependOnceListener=function(e,n){return b(n),this.prependListener(e,K(this,e,n)),this};a.prototype.removeListener=function(e,n){var r,i,s,o,u;if(b(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){u=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():me(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,u||n)}return this};a.prototype.off=a.prototype.removeListener;a.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function X(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?pe(i):H(i,i.length)}a.prototype.listeners=function(e){return X(this,e,!0)};a.prototype.rawListeners=function(e){return X(this,e,!1)};a.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):U.call(t,e)};a.prototype.listenerCount=U;function U(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?x(this._events):[]};function H(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function me(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function pe(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function we(t,e){return new Promise(function(n,r){function i(o){t.removeListener(e,s),r(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}V(t,e,s,{once:!0}),e!=="error"&&ve(t,i,{once:!0})})}function ve(t,e,n){typeof t.on=="function"&&V(t,"error",e,n)}function V(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){r.once&&t.removeEventListener(e,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}const G=[];function ye(t){t.on("document_start",e=>k(t,e)),t.on("document_end",e=>k(t,e)),t.on("document_idle",e=>k(t,e))}function Ue(t,e){G.push([t,e])}function k(t,e){G.forEach(([n,r])=>{!(n.match_about_blank&&/^about:blank/.test(e))&&(!y(n.matches.map(h),e)||n.exclude_matches&&y(n.exclude_matches.map(h),e)||n.include_globs&&!y(n.include_globs.map(h),e)||n.exclude_globs&&y(n.exclude_globs.map(h),e)||!y(r.map(h),e))||(n.js&&n.js.forEach(async i=>{t.executeScript(await i)}),n.css&&n.css.forEach(async i=>{t.addStyle(await i)}))})}function y(t,e){for(const n of t)if(n.test(e))return!0;return!1}const M=[];function He(t){M.push(t)}function ge(t){_e("tabcreate",t),t.on("document_start",e=>{M.forEach(n=>{n.getInjects().map(({pattern:r,script:i})=>{h(r).test(e)&&t.iframe.contentWindow&&i(t.iframe.contentWindow)})})})}function _e(t,...e){M.forEach(n=>{n.emit(t,...e)})}const Le=W('<div class="w-full hover:bg-[#52525E] text-white text-[11px] px-2 py-1 cursor-default select-none"></div>');function Ee(t){return(()=>{const e=Le.cloneNode(!0);return Z(e,"click",t.onClick,!0),j(e,()=>t.text),e})()}P(["click"]);const xe=W('<div id="context-menu"></div>'),be=W('<hr class="border-[#b5b5b5] my-1">'),[ke,Ce]=f(0),[Te,We]=f(0),[Se,Me]=f(0),[Re,Ae]=f(0),[Ne,m]=f(!1),[Oe,$e]=f([]);function Y(t){const e=t instanceof HTMLIFrameElement?t.contentWindow:t;!e||(e.addEventListener("visibilitychange",()=>{m(!1)}),e.addEventListener("mousemove",n=>{let r=0,i=0;if(t instanceof HTMLIFrameElement){const s=t.getBoundingClientRect();r=s.left,i=s.top}Ce(n.clientX+r),We(n.clientY+i)}),e.addEventListener("contextmenu",n=>{if(n.preventDefault(),n.data){m(!0),$e(n.data);let r=document.querySelector("#context-menu")?.offsetWidth,i=document.querySelector("#context-menu")?.offsetHeight,s=ke(),o=Te();r&&s>window.innerWidth-r&&(s-=r),i&&o>window.innerHeight-i&&(o-=i),Me(s),Ae(o)}else m(!1)}),e.addEventListener("click",()=>{m(!1)}),e.addEventListener("keydown",n=>{m(!1)}))}function Ve(){ee(()=>{Y(window)});function t(e){e.preventDefault(),e.stopPropagation()}return(()=>{const e=xe.cloneNode(!0);return e.$$click=t,e.$$contextmenu=t,j(e,A(te,{get each(){return Oe()},children:n=>n.separator?be.cloneNode(!0):A(Ee,{get text(){return n.text},onClick:()=>{m(!1),n.onClick()}})})),ne(n=>{const r=`fixed ${Ne()?"display":"hidden"} w-48 bg-[#2B2A33] shadow-lg rounded border border-[#b5b5b5] py-1`,i=`left: ${Se()}px; top: ${Re()}px;`;return r!==n._v$&&re(e,n._v$=r),n._v$2=ie(e,i,n._v$2),n},{_v$:void 0,_v$2:void 0}),e})()}P(["contextmenu","click"]);function Ie(t){const e=J(t.target);e&&e.href&&(t.ctrlKey?_(t,e.href,!1,!1):t.shiftKey?_(t,e.href,!0,!1):e.target==="_blank"?_(t,e.href,!1,!0):(e.target==="_parent"||e.target==="_top")&&D(t,e.href))}function _(t,e,n,r){t&&t.preventDefault();const i=JSON.parse(localStorage.getItem("preferences")||"{}");n&&!i["general.tabs.openWindowLinksInTab"]?window.open(`${location.origin}?url=${encodeURIComponent(e)}`):new w(e,i["general.tabs.switchToMedia"]||r)}function D(t,e){t.preventDefault(),l().navigate(e)}function J(t){if(!t)return;const e=t;return e.tagName==="A"?e:e.parentElement?J(e.parentElement):void 0}function De(t){const e=[];T(t,"a")&&e.push(new c({text:"Open link in new tab",onClick:()=>{_(void 0,g(t,"href"),!0,!1)}}),new c({text:"Copy link address",onClick:()=>{navigator.clipboard.writeText(g(t,"href"))}}),new c({separator:!0})),T(t,"img")&&e.push(new c({text:"Open image in new tab",onClick:()=>{_(void 0,g(t,"src"),!0,!1)}}),new c({text:"Copy image address",onClick:()=>{navigator.clipboard.writeText(g(t,"src"))}}),new c({separator:!0}));const n=l().iframe.contentWindow?.getSelection()?.toString();return n&&e.push(new c({text:"Copy",onClick:()=>{navigator.clipboard.writeText(n)}}),new c({separator:!0})),e.length===0&&e.push(new c({text:"Back",onClick:()=>{l().goBack()}}),new c({text:"Forward",onClick:()=>{l().goForward()}}),new c({text:"Reload",onClick:()=>{l().reload()}}),new c({separator:!0})),e.push(new c({text:"View Page Source",onClick:()=>{new w("view-source:"+l().url(),!0)}}),new c({text:"Inspect",onClick:()=>{l().setDevTools(!0)}})),e}function T(t,e){return t.tagName.toLowerCase()===e?!0:t.parentElement?T(t.parentElement,e):!1}function g(t,e){return t[e]?t[e]:t.parentElement?g(t.parentElement,e):""}function je(t){for(const e of oe())t.key.toLowerCase()===e.key.toLowerCase()&&t.ctrlKey===e.ctrl&&t.shiftKey===e.shift&&t.altKey===e.alt&&t.metaKey===e.meta&&(t.preventDefault(),e.callback(t))}async function Pe(t,e){if(!N()){const s=typeof window.__uv$config.bare=="string"?window.__uv$config.bare:window.__uv$config.bare[Math.floor(Math.random()*window.__uv$config.bare.length)];se(new le(new URL(s,location.toString())))}const n=N();if(!n)return;const r=await n.fetch(new URL(t,e));if(!r.ok)return;const i=await r.json();if(!!i)try{window.xen.parent.send("pwaRequest",{manifestURL:t,meta:e,manifest:i})}catch{}}function Be(t){z(t),ge(t)}function z(t){t.iframe.contentWindow?.addEventListener("keydown",je),t.iframe.contentWindow?.addEventListener("click",Ie),(t.iframe.contentWindow||{}).open=e=>new w(e,!0).iframe.contentWindow,(t.iframe.contentWindow||{}).close=()=>{t.close()},t.iframe.contentWindow?.addEventListener("unload",()=>{setTimeout(()=>{z(t),t.updateStorage(),t.emit("document_start",C(t.url()))}),t.loading=!0}),t.iframe.contentWindow?.addEventListener("wheel",()=>{setTimeout(()=>{t.scrollPos=t.iframe.contentDocument?.documentElement.scrollTop||0})}),t.iframe.contentWindow?.addEventListener("contextmenu",e=>{e.target&&(e.data=De(e.target))}),t.iframe.contentWindow?.addEventListener("DOMContentLoaded",()=>{Fe(t),t.emit("document_end",C(t.url()))}),t.iframe.contentWindow?.addEventListener("load",async()=>{if(t.setDevTools(!1),t.emit("document_idle",C(t.url())),"Velocity"in window&&((await window.Velocity.history.get()).find(n=>{const r=n.id===t.historyId,i=fe(n.url,t.url());return r&&i})||(t.historyId=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)),window.Velocity.history.add(t)),"xen"in window){const e=t.iframe.contentDocument?.querySelector("link[rel='manifest']")?.href;e&&Pe(e,t.url())}}),(t.iframe.contentWindow||{}).open=e=>new w(e,!0).iframe.contentWindow,(t.iframe.contentWindow||{}).close=()=>{t.close()},Y(t.iframe)}function Fe(t){t.iframe.contentWindow&&(t.iframe.contentWindow.history.pushState=new Proxy(t.iframe.contentWindow.history.pushState,{apply(e,n,r){return setTimeout(()=>{t.historyId=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),window.Velocity.history.add(t)}),Reflect.apply(e,n,r)}}),t.iframe.contentWindow.history.replaceState=new Proxy(t.iframe.contentWindow.history.replaceState,{apply(e,n,r){return setTimeout(()=>{window.Velocity.history.add(t)}),Reflect.apply(e,n,r)}}))}function C(t){try{return new URL(t).toString()}catch{return t}}class w extends S.exports{iframe=document.createElement("iframe");id=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER);historyId=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER);#t=f(!1);#n=f(!1);#e=f("");#r=f("");#s=f(!1);#i=f("");#a=f(!1);#f=f(!0);#c=f(!1);scrollPos=0;constructor(e,n){super(),ye(this),this.iframe.classList.add("w-full","h-full","border-0"),n||this.iframe.classList.add("hidden"),document.querySelector("#content")?.appendChild(this.iframe),Be(this),this.navigate(e||"about:newTab"),requestAnimationFrame(this.#o.bind(this)),O([...d(),this]),n?(this.focus=!0,L(new Set([this,...E()]))):L(new Set([...E(),this]))}goBack(){this.iframe.contentWindow?.history.back()}goForward(){this.iframe.contentWindow?.history.forward()}pin(){}reload(){this.navigate(this.url()||"about:newTab")}stop(){this.loading=!1,this.iframe.contentWindow?.stop()}navigate(e){let n=ce(e);this.iframe.onload=()=>{this.loading=!1},this.iframe.src=n,this.updateStorage()}close(e){e&&e.stopPropagation(),d().length===1&&new w("about:newTab",!0),this.#u(),L(new Set(Array.from(E()).filter(n=>n!==this))),O(d().filter(n=>n!==this)),l().focus=!0,this.updateStorage()}bookmark(){new ae({name:this.#e[0](),url:this.#r[0](),icon:this.#i[0]()})}executeScript(e){return this.iframe.contentWindow?.window.eval(e)}addStyle(e){const n=this.iframe.contentDocument.createElement("style");n.innerText=e,this.iframe.contentDocument?.head.appendChild(n)}setDevTools(e){const n=this.iframe.contentWindow;if(!n.eruda){const i=document.createElement("script");i.src="https://cdn.jsdelivr.net/npm/eruda",i.onload=()=>{this.setDevTools(e)},this.iframe.contentDocument?.body.appendChild(i);return}n.eruda._isInit||n.eruda.init();const r=n.eruda._entryBtn._$el[0].cloneNode(!0);r.style.display="none",n.eruda._entryBtn._$el[0].parentElement.replaceChild(r,n.eruda._entryBtn._$el[0]),r.onclick=()=>{r.style.display="none",n.eruda.hide()},n.eruda._entryBtn._$el[0]=r,e?(r.style.display="flex",n.eruda.show()):e!==void 0||n.eruda._shadowRoot.querySelector(".eruda-dev-tools").style.display!=="none"?(r.style.display="none",n.eruda.hide()):(r.style.display="flex",n.eruda.show())}#u(){document.querySelector("#content")?.removeChild(this.iframe)}updateStorage(){localStorage.setItem("tabs",JSON.stringify(Array.from(d()).map(e=>e.url())))}#o(){if(!this.iframe.contentWindow||!this.iframe.contentDocument){setTimeout(this.#o.bind(this),100);return}if(this.#r[1](ue(this.iframe.contentWindow?.__uv$location?.toString()||this.iframe.src)),this.title=this.iframe.contentDocument?.title||this.#r[0](),this.iframe.contentDocument.head){const n=this.iframe.contentDocument.head.querySelectorAll("link[rel='favicon'], link[rel='shortcut icon'], link[rel='icon']");let r;try{r=new URL("/favicon.ico",this.url()).toString()}catch{}for(let i=n.length-1;i>=0;i--)if(Array.from(n)?.at(i)?.href){r=Array.from(n).at(i)?.href;break}r&&/^data:/.test(r)?this.icon=r:r&&(this.icon=r)}const e=Array.from(this.iframe.contentDocument?.querySelectorAll("audio, video")??[]);this.playing=e.some(n=>!n.paused&&!n.muted),setTimeout(this.#o.bind(this),100)}get url(){return this.#r[0]}set focus(e){e&&(d().forEach(n=>{n.focus=!1,n.iframe.classList.add("hidden")}),L(new Set([this,...E()])),this.iframe.classList.remove("hidden"),(this.iframe.contentDocument||{documentElement:{}}).documentElement.scrollTop=this.scrollPos,localStorage.setItem("activeTab",d().findIndex(n=>n.id===this.id).toString())),this.#a[1](e)}get focus(){return this.#a[0]}get search(){return this.#s[0]}set search(e){this.#s[1](e)}get pinned(){return this.#t[0]}set pinned(e){this.#t[1](e)}get title(){return this.#e[0]}set title(e){this.#e[1](e)}get icon(){return this.#i[0]}set icon(e){this.#i[1](e)}get loading(){return this.#f[0]}set loading(e){this.#f[1](e)}get playing(){return this.#c[0]}set playing(e){this.#c[1](e)}get small(){return this.#n[0]}}export{c as C,w as T,Ve as a,He as b,Y as c,S as e,je as k,_ as o,Ue as r};
